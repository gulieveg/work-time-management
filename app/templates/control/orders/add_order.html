{% extends "control/base.html" %}

{% block title %}Добавление заказа{% endblock title %}

{% block content %}
<div class="content-section">
    <div class="tabs">
        <form method="GET" action="{{ url_for('control.orders.orders_table') }}">
            <button class="tab-button"><i class="fas fa-list"></i>Список заказов</button>
        </form>
        <form method="GET" action="{{ url_for('control.orders.add_order') }}">
            <button class="tab-button active"><i class="fas fa-plus"></i>Добавить заказ</button>
        </form>
    </div>

    <form method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label>Номер заказа</label>
            <div>
                <i class="fas fa-hashtag"></i>
                <input type="text"
                       name="order_number"
                       value="{{ request.form.get('order_number', '') }}"
                       class="order-number"
                       placeholder="Номер заказа"
                       autocomplete="off"
                       required/>
            </div>
        </div>

        <div class="form-group">
            <label>Наименование заказа</label>
            <div>
                <i class="fas fa-cogs"></i>
                <input type="text"
                       name="order_name"
                       value="{{ request.form.get('order_name', '') }}"
                       class="order-name"
                       placeholder="Наименование заказа"
                       autocomplete="off"
                       required/>
            </div>
        </div>

        <p class="tabs-section-title">Перечень работ для заказа</p>

        <div class="sub-tabs">
            <button type="button" class="sub-tab-button active" data-tab="file-tab">
                <i class="fas fa-file-upload" style="margin-right: 8px;"></i>Загрузка таблицы
            </button>
            <button type="button" class="sub-tab-button" data-tab="manual-tab">
                <i class="fas fa-edit" style="margin-right: 8px;"></i>Ручное заполнение
            </button>
        </div>

        <div class="tab-content active" id="file-tab">
            <div class="form-group">
                <p class="upload-instruction">
                    Формат: первая колонка — наименование работы, вторая — плановая трудоемкость.
                    Допустимые расширения: XLSX, XLS
                </p>

                <div class="file-upload-container">
                    <input type="file"
                           name="file_upload"
                           class="file-upload"
                           accept=".xlsx,.xls"/>
                    <button type="button" class="upload-button">Выбрать таблицу</button>
                    <span class="file-upload-label">Таблица не выбрана</span>
                </div>
            </div>
        </div>

        <div class="tab-content" id="manual-tab">
            <div class="form-group">
                <p class="upload-instruction">
                    Введите наименование работы и плановую трудоемкость. Можно добавить несколько строк.
                </p>
                <table class="manual-table">
                    <thead>
                        <tr>
                            <th>Наименование работы</th>
                            <th>Плановая трудоемкость</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="manual-rows">
                        <tr>
                            <td><input type="text" name="work_name[]" required></td>
                            <td><input type="number" name="work_hours[]" step="0.01" required></td>
                            <td><button type="button" class="delete-work">Х</button></td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" id="add-row" class="default-button">
                    Добавить работу
                </button>
            </div>
        </div>

        <div class="form-buttons">
            <button type="submit" class="default-button">
                <i class="fas fa-save"></i> Сохранить заказ
            </button>

            <a href="{{ url_for('control.orders.orders_table') }}" class="default-button">
                <i class="fas fa-undo"></i>Отменить
            </a>
        </div>
    </form>

    <div class="flashed-messages">
        {% for category, message in get_flashed_messages(with_categories=true) %}
            <div class="{{ category }}" id="message">
                <p>{{ message }}</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock content %}
