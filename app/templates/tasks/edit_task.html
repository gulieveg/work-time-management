{% extends "base.html" %}

{% block title %}Редактирование задания{% endblock %}

{% block content %}
    <div id="work-types-data" data-work-types='{{ work_types_data | tojson | safe }}'></div>
    <div class="edit-task-container">
        <p class="paragraph">Редактирование задания</p>
        <form method="POST">
            <div class="form-group">
                <i class="fas fa-user" style="left: 14px;"></i>
                <input
                    type="text"
                    name="employee_data"
                    class="employee-data"
                    placeholder="ФИО работника"
                    value="{{ '{} ({})'.format(employee_name, personnel_number) if employee_name and personnel_number else '' }}"
                    required
                />
                <div class="employee-data-suggestions suggestions-list"></div>
            </div>

            <div class="form-group">
                <i class="fas fa-calendar-alt" style="left: 14px;"></i>
                <input
                    type="date"
                    name="operation_date"
                    value="{{ operation_date }}"
                    required
                />
            </div>

            <div class="task-fields">
                <div class="form-group">
                    <i class="fas fa-clock" style="left: 14px;"></i>
                    <input
                        type="number"
                        name="hours"
                        min="0"
                        max="8.25"
                        step="0.01"
                        placeholder="Часы работы"
                        value="{{ hours }}"
                        required
                    />
                </div>

                <div class="form-group">
                    <i class="fas fa-cogs" style="left: 14px;"></i>
                    <input
                        type="text"
                        name="order_name"
                        class="order-name"
                        placeholder="Наименование заказа"
                        value="{{ order_name }}"
                        required
                    />
                    <div class="order-name-suggestions suggestions-list"></div>
                </div>

                <div class="form-group">
                    <i class="fas fa-hashtag" style="left: 14px;"></i>
                    <input
                        type="text"
                        name="order_number"
                        class="order-number"
                        placeholder="Номер заказа"
                        value="{{ order_number }}"
                        required
                    />
                    <div class="order-number-suggestions suggestions-list"></div>
                </div>

                {% if not current_user.is_factory_worker %}
                    <div class="form-group">
                        <i class="fas fa-tools" style="left: 14px;"></i>
                        <input
                            type="text"
                            name="work_type"
                            class="work-type"
                            placeholder="Наименование работы"
                            value="{{ work_type }}"
                            required
                        />
                        <i class="fas fa-chevron-down show-work-types" style="right: 4px; padding: 10px; cursor: pointer;"></i>
                        <div class="work-type-suggestions suggestions-list"></div>
                    </div>
                {% endif %}
            </div>

            {% set params = {
                "department": request.args.get("department"),
                "start_date": request.args.get("start_date"),
                "end_date": request.args.get("end_date"),
                "employee_data": request.args.get("employee_data"),
                "order_number": request.args.get("order_number"),
                "operation_type": request.args.get("operation_type"),
                "order_name": request.args.get("order_name"),
            } %}

            <div class="edit-task-buttons-container">
                <button type="submit" class="default-button save-task-button">Сохранить изменения</button>
                <a href="{{ url_for('tasks.tasks_table', **params) }}" class="default-button cancel-button">Отмена</a>
            </div>
        </form>
    </div>

    <div class="flashed-messages" style="width: 640px;">
        {% for category, message in get_flashed_messages(with_categories=true) %}
            <div class="{{ category }}" id="message">
                <p>{{ message }}</p>
            </div>
        {% endfor %}
    </div>
{% endblock %}
