{% extends "base.html" %}

{% block title %}Добавление заданий{% endblock title %}

{% block content %}
    <div id="work-types-data" data-work-types='{{ work_types_data | tojson | safe }}'></div>
    <div class="add-task-container">
        <p class="paragraph">Добавление заданий</p>
        <form method="POST">
            <div class="form-group">
                <i class="fas fa-user" style="left: 14px;"></i>
                <input
                    type="text"
                    name="employee_data"
                    class="employee-data"
                    placeholder="ФИО работника"
                    autocomplete="off"
                    value="{{ employee_data | default('') }}"
                    required
                />
                <div class="employee-data-suggestions suggestions-list"></div>
            </div>

            <div class="form-group">
                <i class="fas fa-calendar-alt" style="left: 14px;"></i>
                <input
                    type="date"
                    name="operation_date"
                    value="{{ operation_date | default('') }}"
                    style="cursor: pointer;"
                />
            </div>

            <div id="tasks-container">
                {% if hours_list and order_names and order_numbers %}
                    {% set work_types = work_types if work_types else [""] * hours_list | length %}
                    {% for hours, order_name, order_number, work_type in hours_list | zip_iterables(order_names, order_numbers, work_types) %}
                        <div class="task-fields">
                            <p class="task-number">Задание &#8470;{{ loop.index }}</p>
                            <div class="form-group">
                                <i class="fas fa-clock" style="left: 14px;"></i>
                                <input
                                    type="number"
                                    name="hours[]"
                                    value="{{ hours }}"
                                    min="0"
                                    max="8.25"
                                    step="0.01"
                                    placeholder="Часы работы"
                                    required
                                />
                            </div>
                            <div class="form-group">
                                <i class="fas fa-cogs" style="left: 14px;"></i>
                                <input
                                    type="text"
                                    name="order_name[]"
                                    value="{{ order_name }}"
                                    class="order-name"
                                    placeholder="Наименование заказа"
                                    autocomplete="off"
                                    required
                                />
                                <div class="order-name-suggestions suggestions-list"></div>
                            </div>
                            <div class="form-group">
                                <i class="fas fa-hashtag" style="left: 14px;"></i>
                                <input
                                    type="text"
                                    name="order_number[]"
                                    value="{{ order_number }}"
                                    class="order-number"
                                    placeholder="Номер заказа"
                                    autocomplete="off"
                                    required
                                />
                                <div class="order-number-suggestions suggestions-list"></div>
                            </div>
                            {% if not current_user.is_factory_worker %}
                                <div class="form-group">
                                    <i class="fas fa-tools" style="left: 14px;"></i>
                                    <input
                                        type="text"
                                        name="work_type[]"
                                        value="{{ work_type }}"
                                        class="work-type"
                                        placeholder="Наименование работы"
                                        autocomplete="off"
                                        required
                                    />
                                    <i class="fas fa-chevron-down show-work-types" style="right: 4px; padding: 10px; cursor: pointer;"></i>
                                    <div class="work-type-suggestions suggestions-list"></div>
                                </div>
                            {% endif %}
                            <button type="button" class="default-button delete-form-task-button">Удалить задание</button>
                            <hr>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="task-fields">
                        <p class="task-number">Задание &#8470;1</p>
                        <div class="form-group">
                            <i class="fas fa-clock" style="left: 14px;"></i>
                            <input
                                type="number"
                                name="hours[]"
                                min="0"
                                max="8.25"
                                step="0.01"
                                placeholder="Часы работы"
                                required
                            />
                        </div>
                        <div class="form-group">
                            <i class="fas fa-cogs" style="left: 14px;"></i>
                            <input
                                type="text"
                                name="order_name[]"
                                class="order-name"
                                placeholder="Наименование заказа"
                                autocomplete="off"
                                required
                            />
                            <div class="order-name-suggestions suggestions-list"></div>
                        </div>
                        <div class="form-group">
                            <i class="fas fa-hashtag" style="left: 14px;"></i>
                            <input
                                type="text"
                                name="order_number[]"
                                value="{{ order_number }}"
                                class="order-number"
                                placeholder="Номер заказа"
                                autocomplete="off"
                                required
                            />
                            <div class="order-number-suggestions suggestions-list"></div>
                        </div>
                        {% if not current_user.is_factory_worker %}
                            <div class="form-group">
                                <i class="fas fa-tools" style="left: 14px;"></i>
                                <input
                                    type="text"
                                    name="work_type[]"
                                    class="work-type"
                                    placeholder="Наименование работы"
                                    autocomplete="off"
                                    required
                                />
                                <i class="fas fa-chevron-down show-work-types" style="right: 4px; padding: 10px; cursor: pointer;"></i>
                                <div class="work-type-suggestions suggestions-list"></div>
                            </div>
                        {% endif %}
                        <button type="button" class="default-button delete-form-task-button">Удалить задание</button>
                        <hr>
                    </div>
                {% endif %}
            </div>
            <div class="add-task-buttons-container">
                <button type="button" id="add-form-task-button" class="default-button add-form-task-button">Добавить задание</button>
                <button type="submit" class="default-button save-form-tasks-button">Сохранить задания</button>
            </div>
        </form>

        <div class="flashed-messages-right">
            {% for category, message in get_flashed_messages(with_categories=true) %}
                <div class="{{ category }}" id="message">
                    <p>{{ message }}</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="modal-container">
        <div class="modal-content">
            <span class="close-modal-button"><i class="fas fa-times"></i></span>
            <p class="modal-text">Вы уверены, что хотите удалить задание?</p>
            <div class="modal-buttons">
                <button id="confirm-delete-task" class="btn btn-danger">Удалить</button>
                <button id="cancel-delete-task" class="btn btn-secondary">Отмена</button>
            </div>
        </div>
    </div>
{% endblock content %}
